(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2367)}])},2367:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return f}});var s,o,i,a,r,l,u=n(5893);(s=a||(a={})).Kbps="Kbps",s.Mbps="Mbps",s.auto="auto";var d=n(196),p=n(7294),c=n(1570);let h=t=>{let e=t.reduce(function(t,e,n,s){return n&&t.push(Math.abs(e-s[n-1])),t},[]).filter(t=>0!==t),n=e.reduce(function(t,e){return t+e})/e.length;return Math.round((n+Number.EPSILON)*100)/100};(o=r||(r={})).UPLOAD="upload",o.DOWNLOAD="download";let g=t=>{let e=t.length,n=t.slice(Math.ceil(22*e/100));return parseFloat((n.reduce((t,e)=>t+e,0)/n.length).toFixed(2))},m=t=>new Blob([new ArrayBuffer(t)],{type:"application/octet-stream"});(i=l||(l={})).RUNNING="running",i.COMPLETED="completed",i.STALE="stale";let b={pingFrequency:10,testDurationInSeconds:20,speedUnit:a.auto},w=function(){let{pingFrequency:t=b.pingFrequency,testDurationInSeconds:e=b.testDurationInSeconds,speedUnit:n=b.speedUnit}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,s=Math.min(Math.max(t||5,5),10),o=Math.min(Math.max(e||15,15),60),i={ping:{value:0,unit:"ms"},jitter:{value:0,unit:"ms"},uploadSpeed:{value:0,unit:"Kbps"},downloadSpeed:{value:0,unit:"Kbps"},pingStatus:l.STALE,downloadStatus:l.STALE,uploadStatus:l.STALE,isRunning:!1,isError:!1,isCompleted:!1},[u,w]=(0,p.useState)(i),f={pings:new AbortController,upload:new AbortController,download:new AbortController},D=[],E=[],P=[],N=d.ZP.create({baseURL:"https://speedtest.apyhi.com/"});N.interceptors.request.use(t=>{var e,n;return(null===(e=t.url)||void 0===e?void 0:e.startsWith("/download"))?setTimeout(()=>{f.download.abort()},(0,c.ZP)(o,"seconds").to("milliseconds")):(null===(n=t.url)||void 0===n?void 0:n.startsWith("/upload"))&&setTimeout(()=>{f.upload.abort()},(0,c.ZP)(o,"seconds").to("milliseconds")),t.metadata={startTime:new Date},t},function(t){return Promise.reject(t)}),N.interceptors.response.use(t=>{let e=new Date;return t.headers.duration=(e-t.config.metadata.startTime).toString(),t},function(t){return t.config.metadata.endTime=new Date,t.duration=t.config.metadata.endTime-t.config.metadata.startTime,Promise.reject(t)});let S=(t,e)=>{let s=t===r.DOWNLOAD?"downloadSpeed":"uploadSpeed",o=n,i=e;n===a.auto?e>=(0,c.ZP)(1,"megabit").to("bits")?(o=a.Mbps,i=(0,c.ZP)(e,"bits").to("megabits")):(o=a.Kbps,i=(0,c.ZP)(e,"bits").to("kilobits")):n===a.Mbps?(o=a.Mbps,i=(0,c.ZP)(e,"bits").to("megabits")):(o=a.Kbps,i=(0,c.ZP)(e,"bits").to("kilobits")),i=parseFloat(i.toFixed(2)),w(t=>({...t,[s]:{value:i,unit:o}}))},T=async()=>{if(u.isRunning){console.log("Please wait for previous test to complete.");return}D=[],E=[],P=[],w({...i,isRunning:!0});try{w(t=>({...t,pingStatus:l.RUNNING}));for(let t=0;t<s;t++)await N.get("/health",{signal:f.pings.signal}).then(t=>P.push(parseFloat(t.headers.duration||"0"))).catch(()=>{P.push(0)});let e=P.filter(t=>0!==t).slice(1);if(e.length<4)throw Error("Didn't got sufficient ping");let n=h(e);w(t=>({...t,jitter:{value:n,unit:"ms"},ping:{value:Math.min(...e),unit:"ms"}})),w(t=>({...t,pingStatus:l.COMPLETED,downloadStatus:l.RUNNING})),await N.get("/download/1GiB",{signal:f.download.signal,onDownloadProgress(t){let e=(0,c.ZP)(t.rate||0,"bytes").to("bits");D.push(e),S(r.DOWNLOAD,e)}}).then(()=>{let t=g(D);S(r.DOWNLOAD,t)}).catch(t=>{if("ERR_CANCELED"===t.code){let e=g(D);S(r.DOWNLOAD,e)}else throw t}),w(t=>({...t,downloadStatus:l.COMPLETED,uploadStatus:l.RUNNING}));let o=new FormData;o.append("uploadFile",m((0,c.ZP)(1,"GB").to("bytes"))),await N.post("/upload",o,{signal:f.upload.signal,onUploadProgress(t){let e=(0,c.ZP)(t.rate||0,"bytes").to("bits");E.push(e),S(r.UPLOAD,e)},headers:{"Content-Type":"multipart/form-data"}}).then(()=>{let t=g(E);S(r.UPLOAD,t)}).catch(t=>{if("ERR_CANCELED"===t.code){let e=g(E);S(r.UPLOAD,e)}else throw t}),w(t=>({...t,uploadStatus:l.COMPLETED,isError:!1,isRunning:!1,isCompleted:!0}))}catch(a){console.log(a),w(t=>({...t,isError:!0,isRunning:!1,isCompleted:!0}))}};return{...u,startTest:T}};function f(){let{downloadSpeed:t,isCompleted:e,isError:n,ping:s,startTest:o,uploadSpeed:i,isRunning:r,jitter:l,downloadStatus:d,pingStatus:p,uploadStatus:c}=w({speedUnit:a.auto});return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{onClick:o,children:"Test Now"}),(0,u.jsxs)("p",{children:["Ping: ",s.value," ",s.unit]}),(0,u.jsxs)("p",{children:["jitter: ",l.value," ",l.unit]}),(0,u.jsxs)("p",{children:["Download: ",t.value," ",t.unit]}),(0,u.jsxs)("p",{children:["Upload: ",i.value," ",i.unit]}),(0,u.jsxs)("p",{children:["pingStatus: ",p]}),(0,u.jsxs)("p",{children:["downloadStatus: ",d]}),(0,u.jsxs)("p",{children:["uploadStatus: ",c]}),(0,u.jsxs)("p",{children:["isCompleted: ",e?"True":"False"]}),(0,u.jsxs)("p",{children:["isError: ",n?"True":"False"]}),(0,u.jsxs)("p",{children:["isRunning: ",r?"True":"False"]})]})}}},function(t){t.O(0,[951,774,888,179],function(){return t(t.s=8312)}),_N_E=t.O()}]);